name: Check Reminders

# Runs every hour to check for pending reminders
# This wakes the database and processes any pending reminders without keeping it awake 24/7
# UptimeRobot keeps the Render web server alive via /schedule/health/ (which doesn't query DB)
on:
  schedule:
    # Runs every hour on the hour
    - cron: '0 * * * *'
  
  # Allow manual triggering for testing
  workflow_dispatch:

jobs:
  check-reminders:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check for pending reminders
        run: |
          echo "Checking for pending reminders..."
          
          # Call the reminder check API endpoint
          response=$(curl -s -w "\n%{http_code}" https://qhog.onrender.com/schedule/api/check-reminders/)
          
          # Extract status code (last line)
          http_code=$(echo "$response" | tail -n 1)
          
          # Extract body (everything except last line)
          body=$(echo "$response" | head -n -1)
          
          echo "Response: $body"
          echo "Status: $http_code"
          
          # Check if successful
          if [ "$http_code" = "200" ]; then
            echo "✅ Reminder check successful"
          else
            echo "❌ Reminder check failed with status $http_code"
            exit 1
          fi
      
      - name: Log completion
        if: success()
        run: echo "✅ Reminder check completed at $(date). Next check in 1 hour."
