{% extends 'base.html' %}

{% block title %}Render Usage - Lab Equipment Queue{% endblock %}

{% block content %}
<div class="card">
    <h1>Render Free Tier Usage</h1>
    <p style="color: #7f8c8d; margin-top: 0.5rem;">Monitor usage against Render's free tier limits.</p>
</div>

<!-- Uptime Usage -->
<div class="card" style="border-left: 4px solid {% if uptime_status == 'critical' %}#e74c3c{% elif uptime_status == 'warning' %}#f39c12{% else %}#2ecc71{% endif %};">
    <h2 style="margin-top: 0;">Web Service Uptime</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div>
            <p style="color: #7f8c8d; margin: 0;">Estimated Hours This Month</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ estimated_uptime_hours }} hrs</p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Monthly Limit</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ max_uptime_hours }} hrs</p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Used</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0; color: {% if uptime_status == 'critical' %}#e74c3c{% elif uptime_status == 'warning' %}#f39c12{% else %}#2ecc71{% endif %};">
                {{ uptime_percentage }}%
            </p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Hours Remaining</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ hours_remaining }} hrs</p>
        </div>
    </div>

    <!-- Progress Bar -->
    <div style="background: #ecf0f1; height: 30px; border-radius: 5px; overflow: hidden; margin: 1rem 0;">
        <div style="
            width: {{ uptime_percentage }}%;
            height: 100%;
            background: {% if uptime_status == 'critical' %}#e74c3c{% elif uptime_status == 'warning' %}#f39c12{% else %}#2ecc71{% endif %};
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        ">
            {{ uptime_percentage }}%
        </div>
    </div>

    {% if uptime_status == 'critical' %}
    <div style="background: #fee; border-left: 4px solid #e74c3c; padding: 1rem; margin-top: 1rem;">
        <strong style="color: #e74c3c;">CRITICAL:</strong> Web service is at {{ uptime_percentage }}% of monthly uptime limit.
        You're nearing the 750 hour/month free tier limit. The service may go offline if this limit is exceeded.
    </div>
    {% elif uptime_status == 'warning' %}
    <div style="background: #fef9e7; border-left: 4px solid #f39c12; padding: 1rem; margin-top: 1rem;">
        <strong style="color: #f39c12;">WARNING:</strong> Web service is at {{ uptime_percentage }}% of monthly uptime limit.
        Monitor usage closely to stay within the 750 hour/month free tier.
    </div>
    {% endif %}

    <div style="background: #e8f5e9; border-left: 4px solid #2ecc71; padding: 1rem; margin-top: 1rem;">
        <p style="margin: 0; color: #27ae60;">
            <strong>Note:</strong> Uptime is estimated based on {{ days_this_month }} days elapsed this month (~23.5 hours/day).
            The GitHub Actions workflow keeps the server alive 24/7 by pinging every 5 minutes.
        </p>
    </div>
</div>

<!-- Request Statistics -->
<div class="card">
    <h2 style="margin-top: 0;">Request Statistics</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div>
            <p style="color: #7f8c8d; margin: 0;">Requests This Month</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ requests_this_month|default:"0" }}</p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Days Elapsed</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ days_this_month }} / {{ days_in_month }}</p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Days Remaining</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">{{ days_remaining }}</p>
        </div>
        <div>
            <p style="color: #7f8c8d; margin: 0;">Avg Requests/Day</p>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0.5rem 0;">
                {% if days_this_month > 0 %}
                    {{ avg_requests_per_day|floatformat:0 }}
                {% else %}
                    0
                {% endif %}
            </p>
        </div>
    </div>
</div>

<!-- Database Storage (Reference) -->
<div class="card">
    <h2 style="margin-top: 0;">Database Storage (PostgreSQL)</h2>
    <p style="color: #7f8c8d;">Database storage is tracked separately.</p>
    <a href="{% url 'admin_archive_management' %}" class="btn" style="background: #3498db;">View Storage Management</a>
</div>

<!-- External Links -->
<div class="card">
    <h2 style="margin-top: 0;">External Resources</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="https://dashboard.render.com" target="_blank" class="btn" style="background: #6b46c1;">Render Dashboard</a>
        <a href="https://render.com/docs/free" target="_blank" class="btn" style="background: #95a5a6;">Free Tier Docs</a>
        <a href="{% url 'admin_dashboard' %}" class="btn" style="background: #34495e;">Back to Dashboard</a>
    </div>
</div>
{% endblock %}
