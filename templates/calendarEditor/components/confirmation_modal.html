{% comment %}
Reusable Confirmation Modal Component

Include this in your base template or any page that needs confirmation dialogs.
Works seamlessly with FormProtector for unified UX.

Usage:
    // Show a simple confirmation
    window.confirmModal.show({
        title: 'Delete Entry',
        message: 'Are you sure you want to delete this entry?',
        onConfirm: () => {
            // Perform the action
            myForm.submit();
        }
    });

    // Show confirmation with custom image
    window.confirmModal.show({
        title: 'Undo Check-In',
        message: 'This will return your job to the queue.',
        image: '/static/images/thanos.gif',
        confirmText: 'Yes, Undo',
        cancelText: 'Keep Running',
        onConfirm: () => {
            document.getElementById('undo-form').submit();
        }
    });

    // With custom button styles
    window.confirmModal.show({
        title: 'Cancel Queue Entry',
        message: 'This action cannot be undone.',
        confirmText: 'Delete',
        confirmClass: 'btn-danger',
        onConfirm: () => { /* ... */ }
    });
{% endcomment %}

<style>
    .confirm-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.2s ease-in-out;
    }

    .confirm-modal.show {
        display: flex;
    }

    .confirm-modal-content {
        background: white;
        border-radius: 8px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        text-align: center;
        animation: slideIn 0.3s ease-out;
    }

    .confirm-modal-image {
        max-width: 200px;
        max-height: 200px;
        margin-bottom: 20px;
        border-radius: 8px;
    }

    .confirm-modal-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
    }

    .confirm-modal-message {
        font-size: 16px;
        color: #666;
        margin-bottom: 25px;
        line-height: 1.5;
    }

    .confirm-modal-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    .confirm-modal-actions button {
        min-width: 100px;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .confirm-modal-actions button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .confirm-modal-actions button:active {
        transform: translateY(0);
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideIn {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
</style>

<div id="confirmModal" class="confirm-modal" aria-hidden="true" role="dialog" aria-labelledby="confirmModalTitle" aria-describedby="confirmModalMessage">
    <div class="confirm-modal-content">
        <img id="confirmModalImage" class="confirm-modal-image" src="" alt="" style="display: none;">
        <h2 id="confirmModalTitle" class="confirm-modal-title">Confirm Action</h2>
        <p id="confirmModalMessage" class="confirm-modal-message"></p>
        <div class="confirm-modal-actions">
            <button id="confirmModalYes" class="btn btn-danger" type="button">Yes</button>
            <button id="confirmModalNo" class="btn btn-secondary" type="button">Cancel</button>
        </div>
    </div>
</div>

<script>
/**
 * ConfirmModal - Reusable confirmation dialog
 *
 * Provides a consistent confirmation UX across the application.
 * Integrates with FormProtector for unified action protection.
 */
class ConfirmModal {
    constructor() {
        this.modal = document.getElementById('confirmModal');
        this.title = document.getElementById('confirmModalTitle');
        this.message = document.getElementById('confirmModalMessage');
        this.image = document.getElementById('confirmModalImage');
        this.yesBtn = document.getElementById('confirmModalYes');
        this.noBtn = document.getElementById('confirmModalNo');
        this.callback = null;
        this.isOpen = false;

        // Bind event handlers
        this.noBtn.addEventListener('click', () => this.hide());
        this.yesBtn.addEventListener('click', () => this.confirm());

        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && this.isOpen) {
                this.hide();
            }
        });

        // Close on backdrop click
        this.modal.addEventListener('click', (e) => {
            if (e.target === this.modal && this.isOpen) {
                this.hide();
            }
        });
    }

    /**
     * Show the confirmation modal
     *
     * @param {Object} options - Configuration options
     * @param {string} options.title - Modal title (default: 'Confirm Action')
     * @param {string} options.message - Confirmation message (required)
     * @param {string} options.image - Optional image URL to display
     * @param {string} options.confirmText - Text for confirm button (default: 'Yes')
     * @param {string} options.cancelText - Text for cancel button (default: 'Cancel')
     * @param {string} options.confirmClass - CSS class for confirm button (default: 'btn-danger')
     * @param {string} options.cancelClass - CSS class for cancel button (default: 'btn-secondary')
     * @param {Function} options.onConfirm - Callback when confirmed (required)
     * @param {Function} options.onCancel - Callback when cancelled (optional)
     */
    show(options) {
        if (!options || !options.message) {
            console.error('ConfirmModal.show: message is required');
            return;
        }

        if (!options.onConfirm || typeof options.onConfirm !== 'function') {
            console.error('ConfirmModal.show: onConfirm callback is required');
            return;
        }

        // Set title
        this.title.textContent = options.title || 'Confirm Action';

        // Set message
        this.message.textContent = options.message;

        // Set image if provided
        if (options.image) {
            this.image.src = options.image;
            this.image.style.display = 'block';
        } else {
            this.image.style.display = 'none';
        }

        // Configure confirm button
        this.yesBtn.textContent = options.confirmText || 'Yes';
        this.yesBtn.className = 'btn ' + (options.confirmClass || 'btn-danger');

        // Configure cancel button
        this.noBtn.textContent = options.cancelText || 'Cancel';
        this.noBtn.className = 'btn ' + (options.cancelClass || 'btn-secondary');

        // Store callbacks
        this.callback = options.onConfirm;
        this.cancelCallback = options.onCancel || null;

        // Show modal
        this.modal.classList.add('show');
        this.modal.setAttribute('aria-hidden', 'false');
        this.isOpen = true;

        // Focus on cancel button for accessibility
        this.noBtn.focus();
    }

    /**
     * Hide the modal without confirming
     */
    hide() {
        this.modal.classList.remove('show');
        this.modal.setAttribute('aria-hidden', 'true');
        this.isOpen = false;

        // Execute cancel callback if provided
        if (this.cancelCallback) {
            this.cancelCallback();
        }

        // Clear callbacks
        this.callback = null;
        this.cancelCallback = null;
    }

    /**
     * Confirm the action and execute callback
     */
    confirm() {
        if (this.callback) {
            this.callback();
        }

        this.hide();
    }

    /**
     * Check if modal is currently open
     */
    isVisible() {
        return this.isOpen;
    }
}

// Initialize global instance when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        window.confirmModal = new ConfirmModal();
    });
} else {
    // DOM already loaded
    window.confirmModal = new ConfirmModal();
}
</script>
